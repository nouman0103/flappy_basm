[org 0x0100]

jmp start

bird1: db 12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,12h,5Ch,5Ch,5Ch,5Ch,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,5Ch,5Ch,5Ch,12h,12h,2Ah,2Ah,2Ah,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,0h,0h,5Ch,12h,12h,12h,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,0h,0h,5Ch,12h,12h,5Ch,5Ch,5Ch,42h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,5Ch,5Ch,5Ch,5Ch,5Ch,5Ch,12h,12h,5Ch,5Ch,5Ch,5Ch,42h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,5Ch,12h,12h,12h,5Ch,5Ch,5Ch,5Ch,5Ch,42h,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,12h,12h,12h,12h,12h,12h,42h,5Ch,5Ch,5Ch,5Ch,5Ch,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,12h,12h,12h,12h,12h,12h,12h,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,29h,29h,29h,29h,29h,29h,29h,29h,29h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,29h,29h,04h,04h,04h,04h,04h,12h,12h,12h,12h,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,29h,29h,29h,29h,29h,29h,29h,29h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h
bird2: db 12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,12h,5Ch,5Ch,5Ch,5Ch,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,5Ch,5Ch,5Ch,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,0h,0h,5Ch,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,0h,0h,5Ch,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,5Ch,5Ch,5Ch,5Ch,5Ch,5Ch,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,5Ch,5Ch,5Ch,5Ch,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,12h,12h,42h,5Ch,5Ch,5Ch,5Ch,5Ch,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,5Ch,5Ch,5Ch,5Ch,5Ch,42h,12h,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,5Ch,5Ch,5Ch,5Ch,42h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,12h,29h,29h,29h,29h,29h,29h,29h,29h,29h,12h,12h,12h,12h,12h,12h,12h,2Ah,2Ch,2Ch,2Ch,2Ch,2Ch,2Ch,2Ah,12h,29h,29h,04h,04h,04h,04h,04h,12h,12h,12h,12h,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,2Ah,12h,12h,29h,29h,29h,29h,29h,29h,29h,29h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h,12h

ground: db 0xEE,48h,31h,31h,31h,31h,31h,79h,2Bh,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h
pipe: db 0xEE,0xEE,60h,49h,0xEE,0Ah,0xEE,0Ah,2Fh,60h,60h,60h,60h,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,2Fh,0xEE,2Fh,2Fh,0xEE,2Fh,02h,02h,79h,79h,0xBF,0xEE,0xEE
scoreBoard: db 43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,36h,36h,36h,36h,36h,43h,36h,36h,36h,36h,43h,36h,36h,36h,36h,36h,43h,36h,36h,36h,36h,36h,43h,36h,36h,36h,36h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,36h,36h,69h,69h,69h,43h,36h,36h,69h,69h,43h,36h,36h,69h,36h,36h,43h,36h,36h,69h,36h,36h,43h,36h,36h,69h,69h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,36h,36h,2Bh,2Bh,2Bh,43h,36h,36h,2Bh,2Bh,43h,36h,36h,2Bh,36h,36h,43h,36h,36h,2Bh,36h,69h,43h,36h,36h,2Bh,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,36h,36h,36h,36h,36h,43h,36h,36h,43h,43h,43h,36h,36h,43h,36h,36h,43h,36h,36h,36h,36h,2Bh,43h,36h,36h,36h,36h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,69h,69h,69h,36h,36h,43h,36h,36h,43h,43h,43h,36h,36h,43h,36h,36h,43h,36h,36h,69h,36h,36h,43h,36h,36h,69h,69h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,2Bh,2Bh,2Bh,36h,36h,43h,36h,36h,43h,43h,43h,36h,36h,43h,36h,36h,43h,36h,36h,2Bh,36h,36h,43h,36h,36h,2Bh,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,36h,36h,36h,36h,36h,43h,36h,36h,36h,36h,43h,36h,36h,36h,36h,36h,43h,36h,36h,43h,36h,36h,43h,36h,36h,36h,36h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,69h,69h,69h,69h,69h,43h,69h,69h,69h,69h,43h,69h,69h,69h,69h,69h,43h,69h,69h,43h,69h,69h,43h,69h,69h,69h,69h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,2Bh,2Bh,2Bh,2Bh,2Bh,43h,2Bh,2Bh,2Bh,2Bh,43h,2Bh,2Bh,2Bh,2Bh,2Bh,43h,2Bh,2Bh,43h,2Bh,2Bh,43h,2Bh,2Bh,2Bh,2Bh,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,00h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,36h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,69h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,43h,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh,2Bh
birdy: dw 30
pipesX: dw 150,  300
pipesY: dw 50 ,   20
leftOverPipeWidth: dw 0
leftOverPipeY: dw 0
boolDrawBottomPipe: dw 0
intBottomPipeStart: dw 0
intPipeEndX: dw 0
intBirdBottomY: dw 0
velocityUp: dw 6
velocityUpCounter: dw 0
positionUpCounter: dw 2
velocityDown: dw 5
velocityDownCounter: dw 7
positionDownCounter: dw 5
birdCounter: dw 30
boolCollided: dw 0
score: dw 0
scoreCounter: dw 0
sound: dw 0x149
SPACE_KEY equ 20h
;====================================
defSleep:
pusha
mov cx, 0; keep it 0
mov dx, 0x1388 ; 5000 microseconds
mov ah, 86h ; function 86h
int 15h ; call interrupt 15h
popa
ret

;====================================
defDrawSky: ; Draw a entire row of sky
mov al,35h
mov ah,0ch
mov cx,0
drawSky:
int 10h
inc cx
cmp cx,320
jb drawSky
ret
;====================================
defDrawGround: ; Draw a entire row of ground
mov byte al, [bx]
mov cx,0
drawGround:
int 10h
inc cx
cmp cx,320
jb drawGround
ret
;=====================================
drawBackground:
pusha
mov dx, 0
skyLoop:
call defDrawSky
inc dx
cmp dx, 150
jb skyLoop
mov bx, ground
groundLoop:
call defDrawGround
inc bx
inc dx
cmp dx, 200
jb groundLoop
popa
ret
;=====================================
printnum:
push bp
mov bp, sp
pusha 

cmp word [scoreCounter], 0
jne skipPrint
mov word [scoreCounter], 30
inc word [score]

mov ax, [score] ; load number in ax
mov bx, 10 ; use base 10 for division
mov cx, 0 ; initialize count of digits
nextdigit:
mov dx, 0 ; zero upper half of dividend
div bx ; divide by 10
add dl, 0x30 ; convert digit into ascii value
push dx ; save ascii value on stack
inc cx ; increment count of values
cmp ax, 0 ; is the quotient zero
jnz nextdigit ; if no divide it again

checkCount:
cmp cx, 3 ; is the count 3
jae print3 ; if yes print 3 digits
push '0' ; if no print leading zero
inc cx ; increment count of values
jmp checkCount
print3:
mov bh, 0
mov bl, 0x09
nextpos:
mov ah, 2
mov dh, 22
mov dl, 21
sub dl, cl
push cx
mov cx, 1
int 10h
pop cx
pop ax
mov ah, 0Ah
int 10h
loop nextpos ; repeat for all digits on stack
skipPrint:
dec word [scoreCounter]
popa
pop bp
ret
;=====================================
;Draw Flappy bird, Input: 1 dw element, y Cordinate
defDrawBird:
push bp
mov bp, sp
pusha

mov cx, 40 ; x Cordinate
mov bx, [bp+4] ; y Cordinate
mov dx, bx ; y Cordinate
add bx, 15 ; y Cordinate + 15
mov word [intBirdBottomY], bx ; Save y Cordinate

cmp word [birdCounter], 15
ja selectBird1
mov bx, bird2 ; point bx to bird2
cmp word [birdCounter], 0
ja startDrawBird
mov word [birdCounter], 30
jmp startDrawBird
selectBird1:
mov bx, bird1 ; point bx to bird1

startDrawBird:
dec word [birdCounter]
sub dx,1
mov ah,0ch

mov al,35h
drawTopSky:
int 10h
inc cx
cmp cx,65
jb drawTopSky

mov cx, 40
inc dx

drawBird:
mov byte al, [bx] ; Get pixel color
int 10h ; Draw pixel
inc cx ; x Cordinate + 1
inc bx ; point bx to next pixel
cmp cx, 65 ; Check if x Cordinate is 65
jb drawBird ; If x Cordinate is less than 65, draw another pixel
inc dx ; y Cordinate + 1
mov cx, 40 ; x Cordinate = 40
cmp dx, [intBirdBottomY] ; Check if y Cordinate is equal to y Cordinate
jb drawBird ; If y Cordinate is less than y Cordinate + 15, draw another pixel

mov al,35h
drawBottomSky:
int 10h
inc cx
cmp cx,65
jb drawBottomSky

popa 
pop bp
ret 2

;=====================================
setFallDown:
mov word [velocityDown], 5
mov word [velocityDownCounter], 7
mov word [positionDownCounter], 5
ret

moveBird:
pusha; Push all registers to stack
mov ah,01h ; Get keyboard input
int 16h ; Get keyboard input
jz moveBirdUp
mov ah,00h ; Get keyboard input
int 16h ; Get keyboard input
cmp al,SPACE_KEY ; Check if keyboard input is SPACE_KEY
jne moveBirdUp ; If keyboard input is not SPACE_KEY, jump to moveBirddown

mov word [velocityUp], 0
mov word [positionUpCounter], 0

call setFallDown

moveBirdUp:
call playSound
cmp word [velocityUp], 6
je moveBirdDown
cmp word [positionUpCounter], 2
ja skipMoveUp
dec word [birdy]
mov bx, [velocityUp]
inc bx
mov [positionUpCounter], bx
skipMoveUp:
cmp word [velocityUpCounter], 0
jne endUpMove
inc word [velocityUp]
mov word [velocityUpCounter], 7
endUpMove:
dec word [positionUpCounter]
dec word [velocityUpCounter]
jmp endMoveBird

moveBirdDown:
cmp word [positionDownCounter], 0
jne skipMoveDown
inc word [birdy]
mov bx, [velocityDown]
mov [positionDownCounter], bx

skipMoveDown:
cmp word [velocityDown], 0
je endMoveBird
cmp word [velocityDownCounter], 0
jne endDownMove
dec word [velocityDown]
mov word [velocityDownCounter], 7
endDownMove:
dec word [velocityDownCounter]
dec word [positionDownCounter]



endMoveBird:

popa ; Pop all registers from stack
ret ; Return to mainLoop
;=====================================
defDrawScoreBoard:
push bp
mov bp, sp
pusha

mov cx, [bp+8] ; x Cordinate
mov dx, [bp+10] ; y Cordinate
mov ah, 0ch ; Function
mov bx, scoreBoard ; Point bx to scoreBoard

drawScoreBoard:
mov al, [bx] ; Get pixel color
int 10h ; Draw pixel
inc cx ; x Cordinate + 1
inc bx ; point bx to next pixel
cmp cx, [bp+6]
jb drawScoreBoard
inc dx ; y Cordinate + 1
mov cx, [bp+8]
cmp dx, [bp+4]
jb drawScoreBoard

popa
pop bp
ret 8
;=====================================
defDrawPipe:
push bp
mov bp, sp
pusha

mov cx, [bp+4] ; x Cordinate
mov dx, 0 ; y Cordinate


mov ah, 0ch ; Function
mov bx, [bp+6]
mov word [intBottomPipeStart], bx ; Save y Cordinate
add word [intBottomPipeStart], 50
mov word [boolDrawBottomPipe], 0 ; boolDrawBottomPipe = 0
mov word [intPipeEndX], cx
add word [intPipeEndX], 40

mov bx, pipe

cmp word [bp+8], 1
je drawTopPipe
cmp word [leftOverPipeWidth], 0
jbe endDrawPipe
mov cx, [leftOverPipeWidth]
mov word [intPipeEndX], cx
mov cx, 40
sub cx, [leftOverPipeWidth]
add bx, cx
mov cx, 0
dec word [leftOverPipeWidth]

drawTopPipe:
cmp dx, [bp+6] ; Check if y Cordinate is equal to y Cordinate + 150
je drawBorder
cmp dx, [intBottomPipeStart]
je drawBorder
mov byte al, [bx]
jmp colorSelected
drawBorder:
mov al, 0xEE
colorSelected:
cmp cx, 320
jae endDrawPipe
cmp cx , 0
jb endDrawPipe
int 10h ; Draw pixel
skipPipe:
inc dx ; x Cordinate + 1
cmp dx, [bp+6]
jbe drawTopPipe
cmp dx, [intBottomPipeStart]
ja notSkip
add dx, 49
notSkip:
cmp dx, 150
jb drawTopPipe

inc cx
mov dx, 0
inc bx
cmp cx, [intPipeEndX]
jb drawTopPipe


endDrawPipe:
popa 
pop bp
ret 6

;=====================================
movePipe:
push bp
mov bp, sp
pusha
mov bx, [bp+4] ; Ref to Address of pipesX
dec word [bx] ; Decrement x Cordinate
mov cx, [bx] ; x Cordinate
add cx,41 ; Last x Cordinate + 41
cmp cx, 320
jge adjustX
jmp continueDrawing ; Continue drawing pipe
adjustX:
sub word cx, 320
continueDrawing:
mov dx,0 ; y Cordinate
mov al,35h
mov ah,0ch
mov si,[bp+6] ; Ref to Address of pipesY
drawLastColumnSky:
int 10h
cmp dx, [si] ; y Cordinate
jne continueDrawingSky
cmp cx,41 ; x Cordinate
jb continueDrawingSky
add dx, 50
jmp drawLastColumnSky
continueDrawingSky:
inc dx
cmp dx,150
jb drawLastColumnSky

;Check if pipe is out of screen
sub cx,41 ; Last x Cordinate
cmp cx,0
jne endMovePipe
mov word [leftOverPipeWidth], 40
mov cx, [si]
mov word [leftOverPipeY], cx
mov word [bx], 320
push word [bp+6] ; Ref to Address of pipesY
call generateRandomNumber

endMovePipe:
popa
pop bp
ret 2
;=====================================
defCollided:
push ax
mov word [boolCollided], 1
mov ah,00
int 16h
pop ax
ret

;=====================================
defCheckPipeCollisions:
push bp
mov bp, sp
pusha


; check 1, pipeX > 40 && pipeX < 65
cmp word [bp+6], 40
jb checkx2
cmp word [bp+6], 65
ja checkx2
jmp checkY
checkx2:
; check 2, pipeX < 40
cmp word [bp+6], 40
ja clear
jmp checkY

checkY:
; check Y, pipeY < birdY && pipeY + 50 > birdY

mov dx, [bp+4]
mov bx, [birdy]
cmp dx, bx
ja collided
add dx, 50
add bx, 15
cmp dx, bx
ja clear

collided:
call defCollided


clear:
popa
pop bp
ret 4
;=====================================

defCheckCollisions:
push bp
mov bp, sp
pusha

; check for collision with ground
mov dx, [birdy] ; y Cordinate
cmp dx, 0
ja topCollisionClear
mov word [velocityUp], 6
call setFallDown
mov word [birdy], 1

topCollisionClear:
add dx, 15
cmp dx, 150
jb groundCollisionClear
call defCollided
groundCollisionClear:

push word [pipesX]
push word [pipesY]
call defCheckPipeCollisions

push word [pipesX+2]
push word [pipesY+2]
call defCheckPipeCollisions

popa
pop bp
ret

;=====================================
generateRandomNumber:
push bp ; Push bp to stack
mov bp, sp ; Move sp to bp
pusha ; Push all registers to stack
mov ah,0 ; Function 0
int 1ah ; Get system time
mov ax,dx ; Move dx to ax
mov bx,60 ; Move 60 to bx
mov dx,0 ; Move 0 to dx
div bx ; Divide ax by bx
mov bx, [bp+4] ; Move address of variable to bx
mov word [bx], dx ; Move dx to variable
add word [bx], 20 ; Add 20 to variable
popa ; Pop all registers from stack
pop bp ; Pop bp from stack
ret 2 ; Return to mainLoop

;=====================================

	
;=====================================
playSound:
pusha
mov bl, 10h
call sb_write_dsp

; send byte audio sample
mov si, [sound_index]
mov bl, [sound_data + si]
call sb_write_dsp
cmp word [sound_index], 51529	
jne skipSound
mov word [sound_index], 0
skipSound:
popa
ret
;====================================
sb_write_dsp:
			mov dx, 22ch
		.busy:
			in al, dx
			test al, 10000000b
			jnz .busy
			mov al, bl
			out dx, al
			ret
;=====================================
mainLoop:

call moveBird
call defCheckCollisions
push word [birdy]
call defDrawBird
push pipesY ; y Cordinate address of pipe
push pipesX; x Cordinate address of pipe    
call movePipe
push pipesY+2 ; y Cordinate address of pipe
push pipesX+2 ; x Cordinate address of pipe
call movePipe

push 1
push word [pipesY] ; x Cordinate of pipe
push word [pipesX] ; y Cordinate of pipe
call defDrawPipe
push 1
push word [pipesY+2] ; x Cordinate of pipe
push word [pipesX+2] ; y Cordinate of pipe
call defDrawPipe

push 0
push word [leftOverPipeY]
push 0
call defDrawPipe

call printnum
call playSound
;call defSleep
jmp mainLoop

start:

mov ah, 0
mov al, 13h
int 10h

call drawBackground
push 171 ; y Cordinate
push 110 ; x Cordinate
push 110+61 ; x Cordinate + width
push 171+18 ; y Cordinate + height

call defDrawScoreBoard
jmp mainLoop

mov ax, 0x4c00
int 21h
;================================================
section .data
	sound_index dw 0
	sound_data:
	incbin "kingsv.wav" ;
;================================================